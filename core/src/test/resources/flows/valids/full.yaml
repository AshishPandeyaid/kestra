id: full
namespace: org.kestra.tests

#triggers:
#- type: schedule
#  expression: 42 4 1 * *
#  backfill:
#    start: 2018-01-01
#    depend-on-past: false
#

tasks:
- id: 1st
  type: org.kestra.core.tasks.scripts.Bash
  commands:
  - 'echo "{{ task.id }}"'

- id: 2nd
  type: org.kestra.core.tasks.debugs.Return
  format: second {{ execution.id }}

- id: 3rd
  type: org.kestra.core.tasks.debugs.Echo
  format: third all optional args {{ outputs.2nd.value }}
  timeout: 1000
  retry:
    maxAttempt: 5
    type: constant
    interval: PT15M
#
#- id: 4th
#  type: org.kestra.core.tasks.flows.Each
#  values: [
#    1,
#    2,
#    3
#  ]
#  tasks:
#  - id: 4th - Each
#    type: org.kestra.core.tasks.debugs.Echo
#    format: each {{item}}

- id: 5th
  type: org.kestra.core.tasks.flows.Parallel
  concurrent: 3
  tasks:
  - id: 5th - 1st
    type: org.kestra.core.tasks.scripts.Bash
    commands:
    - echo "4th - 1st {{execution.id}}"
  - id: 5th - 2nd
    type: org.kestra.core.tasks.scripts.Bash
    commands:
    - echo "4th - 2nd {{execution.id}}"
  - id: 5th - 3rd
    type: org.kestra.core.tasks.scripts.Bash
    commands:
    - echo "4th- 3rd {{execution.id}}"
  - id: 5th - 4th
    type: org.kestra.core.tasks.flows.Parallel
    tasks:
      - id: 5th - 4th - 1st
        type: org.kestra.core.tasks.flows.Parallel
        tasks:
        - id: 5th - 4th - 1st - 1st
          type: org.kestra.core.tasks.flows.Parallel
          tasks:
          - id: 5th - 4th - 1st - 1st - 1st
            type: org.kestra.core.tasks.flows.Parallel
            tasks:
            - id: 5th - 4th - 1st - 1st - 1st - last
              type: org.kestra.core.tasks.scripts.Bash
              commands:
                - 'echo "4th - 4th - 1st - 1st - 1st - last : {{execution.id}}"'


- id: lastte
  type: org.kestra.core.tasks.scripts.Bash
  commands:
    - 'echo "last"'
    - 'sleep 1'

#- type: python
#  commands:
#  - print(bla)
#- type: each
#  values: {{selector}}
#  tasks:
#  - type: org.kestra.core.tasks.scripts.Bash
#    commands:
#    - echo {{item}}
#
#- type: switch
#  expression: {{selector}}
#  cases:
#     - value: hello
#       tasks:
#         - type: org.kestra.core.tasks.debugs.Echo
#           text: hello world
#     - value: bye
#       tasks:
#         - type: org.kestra.core.tasks.debugs.Echo
#           text: goodbye world
#  default:
#    - tasks:
#        -type: org.kestra.core.tasks.debugs.Echo
#         text: something else
#
#- type: branch
#  branches:
#    first:
#    - type: org.kestra.core.tasks.scripts.Bash
#      commands:
#      - echo "first branch - step 1"
#    - type: org.kestra.core.tasks.scripts.Bash
#      commands:
#      - echo "first branch - step 2"
#    second:
#    - type: org.kestra.core.tasks.scripts.Bash
#      commands:
#      - echo "second branch - step 1"
#    - type: org.kestra.core.tasks.scripts.Bash
#      commands:
#      - echo "second branch - step 2"
#
#- type: org.kestra.core.tasks.scripts.Bash
#  commands: sleep 5
#  timeout: 1
#  errors:
#    - type: org.kestra.core.tasks.scripts.Bash
#      commands:
#      - echo "first branch - step 1"
#    - type: org.kestra.core.tasks.scripts.Bash
#      commands:
#      - echo "first branch - step 2"